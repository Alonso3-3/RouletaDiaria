<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ruleta Diaria</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #fff6e6;
  margin: 0;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
}

h1 {
  color: #ff4d6d;
  margin: 16px 0 8px;
}

#pointer {
  width: 0;
  height: 0;
  border-left: 18px solid transparent;
  border-right: 18px solid transparent;
  border-bottom: 32px solid #333;
  margin-bottom: -10px;
}

canvas {
  display: block;
}

#spinButton {
  margin-top: 16px;
  padding: 14px 28px;
  font-size: 18px;
  background-color: #ff4d6d;
  color: white;
  border: none;
  border-radius: 10px;
  cursor: pointer;
}

#spinButton:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

#result {
  margin-top: 12px;
  font-size: 18px;
  font-weight: bold;
}
</style>
</head>

<body>

<h1>üç¨ Ruleta Diaria üç¨</h1>
<div id="pointer"></div>
<canvas id="wheel"></canvas>
<button id="spinButton">Gira!</button>
<div id="result"></div>

<script>
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const spinButton = document.getElementById("spinButton");
const resultDiv = document.getElementById("result");

let radius;

// üéØ Resize correctly
function resizeCanvas() {
  const size = Math.min(window.innerWidth * 0.9, 420);
  const dpr = window.devicePixelRatio || 1;

  canvas.width = size * dpr;
  canvas.height = size * dpr;
  canvas.style.width = size + "px";
  canvas.style.height = size + "px";

  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  radius = size / 2;

  drawWheel();
}

window.addEventListener("resize", resizeCanvas);

// üéÅ Prizes
const prizes = [
  { name: "Nothing", probability: 50, color: "#ddd", img: null },
  { name: "Small", probability: 35, color: "#ffcc00", img: "small.png" },
  { name: "Medium", probability: 10, color: "#ff9900", img: "https://i.imgur.com/xlwD8yg.jpeg" },
  { name: "Large", probability: 3, color: "#ff4d6d", img: "large.png" },
  { name: "Big", probability: 2, color: "#00bfff", img: "https://i.imgur.com/WTH6dtx.png" }
];

// preload images
prizes.forEach(p => {
  if (p.img) {
    p.imageObj = new Image();
    p.imageObj.src = p.img;
  }
});

// compute angles
let angle = 0;
prizes.forEach(p => {
  p.startAngle = angle;
  p.endAngle = angle + (p.probability / 100) * Math.PI * 2;
  angle = p.endAngle;
});

function drawWheel() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  prizes.forEach(p => {
    const midAngle = (p.startAngle + p.endAngle) / 2;
    const sliceAngle = p.endAngle - p.startAngle;

    // Draw slice
    ctx.beginPath();
    ctx.moveTo(radius, radius);
    ctx.arc(radius, radius, radius, p.startAngle, p.endAngle);
    ctx.closePath();
    ctx.fillStyle = p.color;
    ctx.fill();

    // ‚õî Skip images for very small slices
    if (!p.imageObj || sliceAngle < 0.25) return;

    ctx.save();

    // ‚úÇÔ∏è Clip to slice
    ctx.beginPath();
    ctx.moveTo(radius, radius);
    ctx.arc(radius, radius, radius, p.startAngle, p.endAngle);
    ctx.closePath();
    ctx.clip();

    // üìê Dynamic image size based on slice
    const imgSize = Math.min(
      radius * 0.45,
      sliceAngle * radius * 0.8
    );

    const imgX = radius + Math.cos(midAngle) * radius * 0.55 - imgSize / 2;
    const imgY = radius + Math.sin(midAngle) * radius * 0.55 - imgSize / 2;
    ctx.globalAlpha = 0.95;
    ctx.drawImage(p.imageObj, imgX, imgY, imgSize, imgSize);

    ctx.restore();
  });
}

resizeCanvas();

// üé∞ Spin logic
spinButton.addEventListener("click", () => {
  spinButton.disabled = true;
  resultDiv.textContent = "Girando...";

  const rand = Math.random() * 100;
  let acc = 0;
  let prize;

  for (const p of prizes) {
    acc += p.probability;
    if (rand <= acc) {
      prize = p;
      break;
    }
  }

  const spins = Math.floor(Math.random() * 5) + 5;
  const winAngle = (prize.startAngle + prize.endAngle) / 2;
  const totalRotation = spins * Math.PI * 2 + (Math.PI * 2 - winAngle);

  let start;

  function animate(ts) {
    if (!start) start = ts;
    const progress = Math.min((ts - start) / 4000, 1);
    const rot = totalRotation * (--progress * progress * progress + 1);

    ctx.save();
    ctx.translate(radius, radius);
    ctx.rotate(rot);
    ctx.translate(-radius, -radius);
    drawWheel();
    ctx.restore();

    if (progress < 1) requestAnimationFrame(animate);
    else resultDiv.textContent = prize.name === "Nothing"
      ? "No ganaste üò¢"
      : "¬°Ganaste!";
  }

  requestAnimationFrame(animate);
});
</script>

</body>
</html>



